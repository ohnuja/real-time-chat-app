<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hangout</title>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<style>
body {
    margin: 0;
    font-family: Segoe UI, sans-serif;
    background: linear-gradient(135deg,#ea66b1,#9ca24b);
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

.chat-container {
    background: white;
    width: 420px;
    height: 580px;
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.header {
    background: #ac5ad8;
    color: white;
    padding: 15px;
    text-align: center;
    font-weight: bold;
}

.join-box {
    padding: 10px;
}

.join-box input {
    width: 100%;
    padding: 8px;
    margin-bottom: 6px;
}

.messages {
    flex: 1;
    padding: 10px;
    background: #f7f7f7;
    overflow-y: auto;
}

.message {
    margin-bottom: 8px;
    padding: 8px;
    border-radius: 10px;
    max-width: 75%;
}

.left { background: #e2e8f0; }
.right {
    background: #d85aaa;
    color: white;
    margin-left: auto;
    text-align: right;
}

.typing {
    font-size: 12px;
    color: gray;
    padding-left: 10px;
}

.input-box {
    display: flex;
    gap: 5px;
    padding: 8px;
}

input[type="text"] {
    flex: 1;
    padding: 8px;
}

button {
    padding: 8px 10px;
    border: none;
    background: #5a67d8;
    color: white;
    border-radius: 6px;
}

img {
    max-width: 200px;
    border-radius: 8px;
}

@media(max-width:600px){
    .chat-container {
        width: 100%;
        height: 100vh;
        border-radius: 0;
    }
}
</style>
</head>

<body>

<div class="chat-container">
    <div class="header">Hangout</div>

    <div class="join-box">
        <input id="username" placeholder="Name">
        <input id="room" placeholder="Room">
        <button onclick="joinRoom()">Join</button>
        <div id="online"></div>
    </div>

    <div class="messages" id="messages"></div>
    <div class="typing" id="typing"></div>

    <div class="input-box">
        <input id="message" placeholder="Type a message" oninput="typingEvent()">

        <input type="file" id="imageInput" accept="image/*" hidden onchange="sendImage()">

        <button onclick="document.getElementById('imageInput').click()">ðŸ“·</button>
        <button onclick="addEmoji('ðŸ˜Š')">ðŸ˜Š</button>
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<audio id="sound">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-message-pop-alert-2354.mp3">
</audio>

<script>
const socket = io();
let user = "";
let room = "";
let typingTimeout;

const messages = document.getElementById("messages");
const typing = document.getElementById("typing");
const sound = document.getElementById("sound");

function joinRoom() {
    user = document.getElementById("username").value;
    room = document.getElementById("room").value;

    if (!user || !room) return alert("Enter name & room");

    socket.emit("join_room", { username: user, room: room });
}

function sendMessage() {
    const msg = message.value;
    if (!msg) return;

    socket.emit("room_message", {
        room: room,
        username: user,
        msg: msg
    });

    messages.innerHTML += `<div class="message right">${user}: ${msg}</div>`;
    message.value = "";
}

function sendImage() {
    const file = imageInput.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
        socket.emit("image_upload", {
            room: room,
            username: user,
            file: reader.result
        });
    };
    reader.readAsDataURL(file);
}

function typingEvent() {
    socket.emit("typing", { username: user, room: room });

    clearTimeout(typingTimeout);
    typingTimeout = setTimeout(() => {
        socket.emit("stop_typing", { room: room });
    }, 1000);
}

function addEmoji(e) {
    message.value += e;
}

/* ---------- SOCKET LISTENERS ---------- */

socket.on("receive_message", data => {
    messages.innerHTML += `<div class="message left">${data.username}: ${data.msg}</div>`;
    sound.play();
});

socket.on("image_message", data => {
    messages.innerHTML += `
        <div class="message left">
            <b>${data.username}</b><br>
            <img src="${data.image_url}">
        </div>`;
});

socket.on("receive_history", data => {
    if (data.message) {
        messages.innerHTML += `<div class="message left">${data.username}: ${data.message}</div>`;
    }
    if (data.image) {
        messages.innerHTML += `
            <div class="message left">
                <b>${data.username}</b><br>
                <img src="${data.image}">
            </div>`;
    }
});

socket.on("update_users", users => {
    online.innerHTML = "ðŸŸ¢ Online: " + users.join(", ");
});

socket.on("show_typing", username => {
    typing.innerText = username + " is typing...";
});

socket.on("hide_typing", () => {
    typing.innerText = "";
});
</script>

</body>
</html>


